#!/usr/bin/env node
const { exec } = require('shelljs')
const program = require('commander')
const { configToJson } = require('./config/helpers/config-to-json')

program.option('-c, --configuration', 'e.g. production')
program.parse(process.argv)

// Translate `config[.*].ts` to JSON.
const { configuration = 'local' } = program.opts()
const configJson = configToJson(configuration)

// TODO: Install `berglas`.
exec(`
  export PROJECT_ID=${configJson.FIRE_PROJECT_ID}
  export BUCKET_ID=${configJson.SECRETS_BUCKET_NAME}
  gcloud services enable --project $PROJECT_ID \
    cloudkms.googleapis.com \
    storage-api.googleapis.com \
    storage-component.googleapis.com
  chmod +x ./berglas
  ./berglas bootstrap --project $PROJECT_ID --bucket $BUCKET_ID
`)
